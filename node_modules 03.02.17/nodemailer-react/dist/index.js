"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.Mailer = void 0;
const nodemailer_1 = require("nodemailer");
const server_1 = require("react-dom/server");
const renderBody = (body) => `<!DOCTYPE html>${(0, server_1.renderToStaticMarkup)(body)}`;
const createTransporter = ({ transport, defaults }) => {
    if ('sendMail' in transport) {
        return transport;
    }
    return (0, nodemailer_1.createTransport)(transport, defaults);
};
const Mailer = (config, emails) => {
    const transporter = createTransporter(config);
    /**
     * Use the `send` method to send your emails
     *
     * @param {string} template Your email template name: key of the email in the record you've provided.
     * @param {Object} props The props of your email component
     * @param {Object} options The options of email (to, from, attachments, etc.)
     * @return Promise
     */
    const sendEmail = (template, props, options) => {
        const { subject, body } = emails[template](props);
        return transporter.sendMail(Object.assign({ subject, html: renderBody(body) }, options));
    };
    return {
        send: sendEmail,
    };
};
exports.Mailer = Mailer;
exports.default = exports.Mailer;
